<script lang="ts">
  import { getThemeStore, OVERRIDE_DARK_THEME, OVERRIDE_LIGHT_THEME } from "$lib/service/themeStore";
	import { onMount, onDestroy } from "svelte";
	import type { Unsubscriber } from "svelte/store";


  const themeStore = getThemeStore()

  function toggleTheme() {
    themeStore.update(
      theme => theme.isDark ? OVERRIDE_LIGHT_THEME : OVERRIDE_DARK_THEME
    )
  }

  const sunCenter = "M24,31c1.933333,0,3.583333,-0.683333,4.95,-2.05c1.367,-1.367,2.05,-3.017,2.05,-4.95c0,-0.0094,0.000034,0.0093,0,0c-0.0069,-1.90425,-0.714345,-3.59721,-2.05,-4.95c-0.01217,-0.01233,0.01228,0.01228,0,0c-0.0069,-0.0069,0.0069,0.0069,0,0c-1.357,-1.347,-3.038,-2.044,-4.95,-2.05c-0.0088,-0.000029,0.0089,0,0,0c-1.933333,0,-3.583333,0.683333,-4.95,2.05c-1.367,1.367,-2.05,3.017,-2.05,4.95c0,1.933333,0.683333,3.583333,2.05,4.95c1.367,1.367,3.017,2.05,4.95,2.05zM24,34c-2.767,0,-5.125,-0.975,-7.075,-2.925c-1.95,-1.95,-2.925,-4.308,-2.925,-7.075c0,-2.766667,0.975,-5.125,2.925,-7.075c1.95,-1.95,4.352893,-2.924915,7.11956,-2.924915c0,0,0,0,0,0c0,0,0,0,0,0c2.734504,0.01038,5.068844,0.976262,7.003019,2.897636c0,0,0,0,0,0c0,0,0,0,0,0c0,0,0,0,0,0c0,0,0,0,0,0c1.943,1.943,2.946,4.348,2.952,7.102c0,0,0,0,0,0c0,0,0,0,0,0c0,2.766667,-0.975,5.125,-2.925,7.075c-1.95,1.95,-4.308,2.925,-7.075,2.925z"
  const moonCenter = "M24,39c3.633333,0,6.8,-1.125,9.5,-3.375c2.7,-2.25,4.383333,-4.891667,5.05,-7.925c-0.833333,0.366667,-1.725,0.641667,-2.675,0.825c-0.95,0.183,-1.908,0.275,-2.875,0.275c-3.833,0,-7.092,-1.342,-9.775,-4.025c-2.683,-2.683,-4.025,-5.942,-4.025,-9.775c0,-0.8,0.08333,-1.658333,0.25,-2.575c0.166667,-0.916667,0.466667,-1.958333,0.9,-3.125c-3.266667,0.9,-5.975,2.725,-8.125,5.475c-2.15,2.75,-3.225,5.825,-3.225,9.225c0,4.167,1.458,7.708,4.375,10.625c2.917,2.917,6.458,4.375,10.625,4.375zM24,42c-5,0,-9.25,-1.75,-12.75,-5.25c-3.5,-3.5,-5.25,-7.75,-5.25,-12.75c0,-5,1.75,-9.25,5.25,-12.75c3.5,-3.5,7.75,-5.25,12.75,-5.25c0.266667,0,0.55,0.00833,0.85,0.025c0.3,0.016667,0.683333,0.041667,1.15,0.075c-1.2,1.0666667,-2.133333,2.3833333,-2.8,3.95c-0.666667,1.566667,-1,3.216667,-1,4.95c0,3,1.05,5.55,3.15,7.65c2.1,2.1,4.65,3.15,7.65,3.15c1.733333,0,3.383333,-0.308333,4.95,-0.925c1.566667,-0.616667,2.883333,-1.475,3.95,-2.575c0.03333,0.4,0.05833,0.725,0.075,0.975c0.017,0.25,0.025,0.492,0.025,0.725c0,5,-1.75,9.25,-5.25,12.75c-3.5,3.5,-7.75,5.25,-12.75,5.25z"
  const sunRaysOpen = "M3.5,25.5c-0.433,0,-0.792,-0.142,-1.075,-0.425c-0.283,-0.283,-0.425,-0.642,-0.425,-1.075c0,-0.433,0.142,-0.792,0.425,-1.075c0.283,-0.283,0.642,-0.425,1.075,-0.425h5c0.4333333,0,0.7916667,0.141667,1.075,0.425c0.283,0.283,0.425,0.642,0.425,1.075c0,0.433,-0.142,0.792,-0.425,1.075c-0.283,0.283,-0.642,0.425,-1.075,0.425zM39.5,25.5c-0.433333,0,-0.791667,-0.141667,-1.075,-0.425c-0.283,-0.283,-0.425,-0.642,-0.425,-1.075c0,-0.433,0.142,-0.792,0.425,-1.075c0.283,-0.283,0.642,-0.425,1.075,-0.425h5c0.433333,0,0.791667,0.141667,1.075,0.425c0.283,0.283,0.425,0.642,0.425,1.075c0,0.433,-0.142,0.792,-0.425,1.075c-0.283,0.283,-0.642,0.425,-1.075,0.425zM24,10c-0.433,0,-0.792,-0.142,-1.075,-0.425c-0.283,-0.283,-0.425,-0.642,-0.425,-1.075v-5c0,-0.433,0.142,-0.792,0.425,-1.075c0.283,-0.283,0.642,-0.425,1.075,-0.425c0.433,0,0.792,0.142,1.075,0.425c0.283,0.283,0.425,0.642,0.425,1.075v5c0,0.4333333,-0.141667,0.7916667,-0.425,1.075c-0.283,0.283,-0.642,0.425,-1.075,0.425zM24,46c-0.433,0,-0.792,-0.142,-1.075,-0.425c-0.283,-0.283,-0.425,-0.642,-0.425,-1.075v-5c0,-0.433333,0.141667,-0.791667,0.425,-1.075c0.283,-0.283,0.642,-0.425,1.075,-0.425c0.433333,0,0.791667,0.141667,1.075,0.425c0.283333,0.283333,0.425,0.641667,0.425,1.075v5c0,0.433333,-0.141667,0.791667,-0.425,1.075c-0.283,0.283,-0.642,0.425,-1.075,0.425zM12,14.100000000000001l-2.85,-2.8c-0.3,-0.3,-0.442,-0.658,-0.425,-1.075c0.017,-0.417,0.158,-0.775,0.425,-1.075c0.3,-0.3,0.658,-0.45,1.075,-0.45c0.417,0,0.775,0.15,1.075,0.45l2.8,2.85c0.266667,0.3,0.4,0.65,0.4,1.05c0,0.4,-0.133333,0.733333,-0.4,1c-0.266667,0.3,-0.608333,0.45,-1.025,0.45c-0.417,0,-0.775,-0.133,-1.075,-0.4zM36.7,38.85l-2.8,-2.85c-0.266667,-0.3,-0.4,-0.658333,-0.4,-1.075c0,-0.416667,0.15,-0.758333,0.45,-1.025c0.266667,-0.3,0.6,-0.45,1,-0.45c0.4,0,0.75,0.15,1.05,0.45l2.85,2.8c0.3,0.3,0.441667,0.658333,0.425,1.075c-0.01667,0.416667,-0.158333,0.775,-0.425,1.075c-0.3,0.3,-0.658333,0.45,-1.075,0.45c-0.417,0,-0.775,-0.15,-1.075,-0.45zM33.900000000000006,14.100000000000001c-0.3,-0.3,-0.45,-0.65,-0.45,-1.05c0,-0.4,0.15,-0.75,0.45,-1.05l2.8,-2.85c0.3,-0.3,0.658333,-0.4416667,1.075,-0.425c0.416667,0.016667,0.775,0.1583333,1.075,0.425c0.3,0.3,0.45,0.6583333,0.45,1.075c0,0.416667,-0.15,0.775,-0.45,1.075l-2.85,2.8c-0.266667,0.266667,-0.608333,0.4,-1.025,0.4c-0.416667,0,-0.775,-0.133333,-1.075,-0.4zM9.150000000000006,38.85c-0.3,-0.3,-0.45,-0.658,-0.45,-1.075c0,-0.417,0.15,-0.775,0.45,-1.075l2.85,-2.8c0.3,-0.3,0.65,-0.45,1.05,-0.45c0.4,0,0.75,0.15,1.05,0.45c0.3,0.3,0.45,0.65,0.45,1.05c0,0.4,-0.15,0.75,-0.45,1.05l-2.8,2.85c-0.3,0.3,-0.658,0.442,-1.075,0.425c-0.417,-0.017,-0.775,-0.158,-1.075,-0.425z"
  const sunRaysClosed = "M6,24c0,0,0,0,0,0c0,0,0,0,0,0c0,0,0,0,0,0c0,0,0,0,0,0h0c0,0,0,0,0,0c0,0,0,0,0,0c0,0,0,0,0,0c0,0,0,0,0,0zM42,24c0,0,0,0,0,0c0,0,0,0,0,0c0,0,0,0,0,0c0,0,0,0,0,0h0c0,0,0,0,0,0c0,0,0,0,0,0c0,0,0,0,0,0c0,0,0,0,0,0zM24,6c0,0,0,0,0,0c0,0,0,0,0,0v0c0,0,0,0,0,0c0,0,0,0,0,0c0,0,0,0,0,0c0,0,0,0,0,0v0c0,0,0,0,0,0c0,0,0,0,0,0zM24,42c0,0,0,0,0,0c0,0,0,0,0,0v0c0,0,0,0,0,0c0,0,0,0,0,0c0,0,0,0,0,0c0,0,0,0,0,0v0c0,0,0,0,0,0c0,0,0,0,0,0zM11.6125,11.6l0,0c0,0,0,0,0,0c0,0,0,0,0,0c0,0,0,0,0,0c0,0,0,0,0,0l0,0c0,0,0,0,0,0c0,0,0,0,0,0c0,0,0,0,0,0c0,0,0,0,0,0zM36.3875,36.375l0,0c0,0,0,0,0,0c0,0,0,0,0,0c0,0,0,0,0,0c0,0,0,0,0,0l0,0c0,0,0,0,0,0c0,0,0,0,0,0c0,0,0,0,0,0c0,0,0,0,0,0zM36.375,11.6125c0,0,0,0,0,0c0,0,0,0,0,0l0,0c0,0,0,0,0,0c0,0,0,0,0,0c0,0,0,0,0,0c0,0,0,0,0,0l0,0c0,0,0,0,0,0c0,0,0,0,0,0zM11.625,36.3625c0,0,0,0,0,0c0,0,0,0,0,0l0,0c0,0,0,0,0,0c0,0,0,0,0,0c0,0,0,0,0,0c0,0,0,0,0,0l0,0c0,0,0,0,0,0c0,0,0,0,0,0z"
  const sun = sunCenter + sunRaysOpen
  const moon = moonCenter + sunRaysClosed
  const duration = "0.2s"

  let sunMoonAnimate: SVGAnimateElement
  let themeStoreSubscription: Unsubscriber
  onMount(() => {
    themeStoreSubscription = themeStore.subscribe(theme => {
      sunMoonAnimate.beginElement()
    })
  })

  onDestroy(() => {
    if (themeStoreSubscription) themeStoreSubscription()
  })
</script>

<button
  aria-label="Toggle theme"
  title="Toggle theme"
  on:click={toggleTheme}>
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
    <path d={$themeStore.isDark ? sun : moon}>
      <animate
        bind:this={sunMoonAnimate}
        attributeName="d"
        dur={duration}
        from={$themeStore.isDark ? moon : sun}
        to={$themeStore.isDark ? sun : moon}
        fill="freeze"
        begin="indefinite" />
    </path>
  </svg> 
</button>

<style lang="scss">
  $size: 2rem;

  button {
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
  }

  svg {
    width: $size;
    height: $size;
    @include themeSwitchProperties(fill, $text-color-light-theme, $text-color-dark-theme);
  }
</style>
